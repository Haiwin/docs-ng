<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Couchbase Server documentation"><title>Stream-based views</title><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script><link rel="stylesheet" href="//yandex.st/highlightjs/8.0/styles/default.min.css"><script src="//yandex.st/highlightjs/8.0/highlight.min.js"></script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700" rel="stylesheet" type="text/css"><link href="/assets-dita/css/base.css" rel="stylesheet"><script src="/assets-dita/js/main.js"></script></head><body><header class="navbar navbar-default navbar-fixed-top"><div class="container"><div class="navbar-header"><a class="navbar-brand" href="http://www.couchbase.com/"><img src="/assets-dita/images/cb-icon-sofa.png" class="logo"></a><a class="navbar-brand" style="color:#000552;" href="/">Couchbase
								Documentation <small>beta</small></a></div><div class="navbar-collapse collapse"><ul class="nav navbar-nav"><li><a href="/">Docs Home</a></li><li><a href="/archive-index">Docs Archive</a></li></ul></div></div></header><div id="content" class="container"><div class="row"><nav class="col-md-3"><div class="well"><ul class="nav nav-list list-group"><li><a href="../Couchbase-intro.html">Introduction</a></li><li><a href="../Whats-new-3.0.html">What's new in 3.0</a></li><li><a href="../install-intro.html">Installation and upgrade</a></li><li><a href="../admin-intro.html">Administration</a><ul class="nav nav-list"><li><a href="../Misc/admin-basics.html">Administration basics</a></li><li><a href="../Concepts/concept-intro.html">Architecture and concepts</a></li><li><a href="../Concepts/bp-deployment-considerations.html">Deployment considerations</a></li><li><a href="../Tasks/cluster-management.html">Cluster management</a></li><li><a href="../Monitoring/monitor-intro.html">Monitoring</a></li><li><a href="../Views/views-intro.html">Views and indexes</a><ul class="nav nav-list"><li><a href="../Views/views-basics.html">View basics</a></li><li class="active"><a href="../Views/views-index-updates.html">Stream-based views</a><ul class="nav nav-list"></ul></li><li><a href="../Views/views-operation.html">Views operation</a></li><li><a href="../Views/views-storedData.html">Views and stored data</a></li><li><a href="../Views/views-development.html">Development views</a></li><li><a href="../Views/views-production.html">Production views</a></li><li><a href="../Views/views-writing.html">Writing views</a></li><li><a href="../Views/views-geospatial.html">Writing geospatial views</a></li><li><a href="../Views/views-querying.html">Querying views</a></li><li><a href="../Views/views-schemaless.html">Views in a schema-less database</a></li><li><a href="../Views/views-translateSQL.html">Translating SQL to map/reduce</a></li><li><a href="../Views/views-querySample.html">View and query pattern samples</a></li></ul></li><li><a href="../XDCR/xdcr-intro.html">Cross Datacenter Replication (XDCR)</a></li><li><a href="../UI/ui-intro.html">Web console</a></li><li><a href="../Misc/faq.html">FAQs</a></li><li><a href="../Misc/sample-bucket-intro.html">Sample buckets</a></li><li><a href="../Misc/Trbl-intro.html">Troubleshooting</a></li><li><a href="../Misc/deprecated.html">Deprecated items</a></li></ul></li><li><a href="../cli-intro.html">CLI reference</a></li><li><a href="../rest-intro.html">REST API reference</a></li><li><a href="../rel-notes/rel-notes3.0.html">Release notes</a></li></ul></div></nav><main class="col-md-9"><div class="gcse-wrapper"><div class="gcse-search"></div></div>

	<h1 class="title topictitle1">Stream-based views</h1>

	


	<div class="body conbody"><div class="abstract">
		 <span class="shortdesc">Stream-based views reduce latency for view updates, providing faster view
			consistency and fresher data.</span>
This feature uses the new streaming protocol,
		Database Change Protocol (DCP). </div>


		<p class="p">With DCP, data does not need to be persisted to disk before you can retrieve it with a view
			query. DCP offers the following benefits for views: </p>

		<ul class="ul">
			<li class="li">Views are updated with key-value data sooner.</li>

			<li class="li">Latency for view updates is reduced.</li>

			<li class="li">Views are more closely synchronized with the data.</li>

		</ul>

		
		<p class="p">The following diagram gives an overview of how stream-based views operate.</p>

		
		<img class="image" src="../images/stream-based-views.png" width="600">

		<p class="p">When you submit a view query, you can include a parameter that specifies your data
			freshness requirements. The name of the parameter is <samp class="ph codeph">stale</samp> and it takes
			the following values:</p>


		<ul class="ul">
			<li class="li"><samp class="ph codeph">ok</samp>—The server returns the current entries from the index file.</li>

			<li class="li"><samp class="ph codeph">update_after</samp>—The server returns the current entries from the index,
				and then initiates an index update.</li>

			<li class="li"><samp class="ph codeph">false</samp>—The server waits for the indexer to finish the changes that
				correspond to the current key-value document set and then returns the latest entries
				from the view index.</li>

		</ul>


		<p class="p">Every 5 seconds the automatic update process checks whether 5000 changes have occurred. If
			a minimum of 5000 changes occurred, an index update is triggered. Otherwise, no update is
			triggered. When triggered, the indexer requests from DCP all changes since it was last run.
			The default number of changes to check for is 5000, but that number can be configured by
			setting the <samp class="ph codeph">updateMinChanges</samp> option. The update interval can also be
			configured by setting the <samp class="ph codeph">updateInterval</samp> option. </p>


		<p class="p">The <samp class="ph codeph">stale=false</samp> view query argument has been enhanced. When an application
			sends a query that has the <samp class="ph codeph">stale</samp> parameter set to false, the application
			receives all recent changes to the documents, including changes that haven't yet been
			persisted to disk. It considers all document changes that have been received at the time
			the query was received. This means that using the durability requirements or observe
			feature to block for persistence in application code before issuing the
				<samp class="ph codeph">stale=false</samp> query is no longer needed. It is recommended that you
			remove all such application level checks after upgrading.</p>



		<div class="note note"><span class="notetitle">Best practice:</span> For better scalability and throughput, we
			recommend that you set the value of the <samp class="ph codeph">stale</samp> parameter to
				<samp class="ph codeph">ok</samp>. With the stream-based views feature, data returned when
				<samp class="ph codeph">stale</samp> is set to <samp class="ph codeph">ok</samp> is closer to the key-value data,
			even though it might not include all of it.</div>



	</div>


<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Views/views-intro.html">Views and indexes</a></div>
</div>
</div></main></div></div><footer><div class="navbar navbar-default navbar-fixed-bottom"><div class="container"><div class="copyright"> © 2014 COUCHBASE All rights reserved. </div></div></div></footer><script type="text/javascript" src="https://www.google.com/jsapi"></script><script>
					(function() {
					var cx = '018016427239405524608:fkg1v30apnm';
					var gcse = document.createElement('script');
					gcse.type = 'text/javascript';
					gcse.async = true;
					gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					'//www.google.com/cse/cse.js?cx=' + cx;
					var s = document.getElementsByTagName('script')[0];
					s.parentNode.insertBefore(gcse, s);
					})();
				</script></body></html>