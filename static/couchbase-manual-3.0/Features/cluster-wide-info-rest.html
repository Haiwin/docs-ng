<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="Couchbase Server product documentation"><style>
					body{
						padding-top:40px; /* make the container go all the way to the bottom of the top bar */
					}</style><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script><link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet"><script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.js"></script><link rel="stylesheet" href="//yandex.st/highlightjs/8.0/styles/default.min.css"><script src="//yandex.st/highlightjs/8.0/highlight.min.js"></script><link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700" rel="stylesheet" type="text/css"><link href="/assets-dita/css/base.css" rel="stylesheet"><script src="/assets-dita/js/main.js"></script></head><body><header class="navbar navbar-fixed-top"><div class="navbar-inner"><div class="container-fluid container"><a class="brand" href="http://www.couchbase.com/"><img src="/assets-dita/images/cb-icon-sofa.png" class="logo"></a><a class="brand" style="color:#000552;" href="/">Couchbase Documentation <small>beta</small></a><div class="nav-collapse collapse"><ul class="nav"><li><a href="/">Docs Home</a></li><li><a href="/archive-index">Docs Archive</a></li></ul></div><div class="gcse-searchbox">box or no box</div></div></div></header><div id="content" class="container-fluid container"><div class="row-fluid"><nav class="span3"><div class="well"><ul class="nav nav-list"><li><a href="../beta-intro.html">Couchbase 3.0 beta introduction</a></li><li><a href="../Features/features.html">Couchbase 3.0 Features</a><ul class="nav nav-list"><li><a href="../Features/bcp.html">Database Change Protocol</a></li><li><a href="../Features/global-thread-pool.html">Shared thread pool</a></li><li><a href="../Features/bucket-eviction.html">Metadata ejection</a></li><li><a href="../Features/bucket-priority.html">Disk I/O priority</a></li><li><a href="../Features/graceful-failover.html">Graceful failover</a></li><li><a href="../Features/delta-node-recovery.html">Delta node recovery</a></li><li><a href="../Features/increment-backup.html">Incremental backup and restore</a></li><li><a href="../Features/index-updates.html">Stream-based views</a></li><li><a href="../Features/xdcr-memory-replication.html">Stream-based XDCR</a></li><li><a href="../Features/security-admin-access.html">Encrypted admin access</a></li><li><a href="../Features/security-clientServer-comm.html">Encrypted data access</a></li><li><a href="../Features/security-client-ssl.html">Configuring clients for SSL</a></li><li><a href="../Features/cluster-wide-info-intro.html">Cluster-wide diagnostics</a><ul class="nav nav-list"><li><a href="../Features/cluster-wide-info-web.html">Managing diagnostics (UI)</a></li><li><a href="../Features/cluster-wide-info-cli.html">Managing diagnostics (CLI)</a></li><li class="active"><a href="../Features/cluster-wide-info-rest.html">Managing diagnostics (REST API)</a><ul class="nav nav-list"></ul></li></ul></li></ul></li><li><a href="../install-intro.html">Couchbase Installation</a></li><li><a href="../admin-intro.html">Couchbase Administration</a></li><li><a href="../cli-intro.html">Couchbase CLI</a></li><li><a href="../rest-intro.html">Couchbase REST API</a></li><li><a href="../rel-notes/rel-notes3.0beta.html">Release notes (beta)</a></li></ul></div></nav><main class="span9">
 <h1 class="title topictitle1">Managing diagnostics (REST API)</h1>

 
 <div class="body conbody"><p class="shortdesc">The REST API enables you to collect and send diagnostics by using HTTP requests.</p>

  <p class="p">You can use the following REST APIs to manage log collection.</p>

 	
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
 			<thead class="thead" align="left">
 				<tr class="row">
 					<th class="entry" valign="top" id="d52784e26">HTTP method</th>

 					<th class="entry" valign="top" id="d52784e29">URI path</th>

 					<th class="entry" valign="top" id="d52784e32">Description</th>

 				</tr>

 			</thead>

 			<tbody class="tbody">
 				<tr class="row">
 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">GET</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">/pools</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 ">Retrieve a list of nodes in the cluster</td>

 				</tr>

 				<tr class="row">
 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">POST</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">/collectLogs/start</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 ">Start log collection</td>

 				</tr>

 				<tr class="row">
 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">POST</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">/collectLogs/cancel</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 ">Cancel log collection</td>
					
 				</tr>

 				<tr class="row">
 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">GET</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 "><samp class="ph codeph">/pools/default/tasks</samp></td>

 					<td class="entry" valign="top" headers="d52784e26 d52784e29 d52784e32 ">Retrieve log collection status</td>

 				</tr>

 			</tbody>

 		</table>
</div>

 	
 	
 	<div class="section"><h2 class="title sectiontitle">Retrieving a list of cluster nodes</h2>
 		
 		<p class="p">You can retrieve a list of the nodes in a cluster with the following HTTP request:</p>

 		<pre class="pre codeblock">
GET /pools
 		</pre>

 		<p class="p">The response contains a list of the nodes in the cluster and the status of each node. The node status can be up, pending, or down.</p>

 	</div>

 	
 	<div class="section"><h2 class="title sectiontitle">Starting log collection</h2>
 		
 		<p class="p">
 			You can start log collection with the following REST request:
 		</p>

 		<pre class="pre codeblock">
POST /collectLogs/start
 		</pre>

 		<p class="p">The message body for this request contains a JSON document that uses the following
				parameters:</p>

 		
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
 				<thead class="thead" align="left">
 					<tr class="row">
 						<th class="entry" valign="top" id="d52784e135">Name</th>

 						<th class="entry" valign="top" id="d52784e138">Type</th>

 						<th class="entry" valign="top" id="d52784e141">Description</th>

 						<th class="entry" valign="top" id="d52784e144">Required</th>

 					</tr>

 				</thead>

 				<tbody class="tbody">
 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 "><samp class="ph codeph">customer</samp></td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">string</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">Customer name. The valid characters are uppercase and lowercase letters, digits, underscore, period, and space. Maximum length is 50 characters. If spaces are used in the customer name, they are replaced with underscores. Invalid values are rejected.</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">yes, when the <samp class="ph codeph">upload</samp> parameter is set to <samp class="ph codeph">true</samp>.</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 "><samp class="ph codeph">from</samp></td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">string</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">Nodes to collect logs from. The value can be:
 							<ul class="ul">
 								<li class="li"><samp class="ph codeph">allnodes</samp>—collect from all nodes in the cluster.</li>

 								<li class="li"><samp class="ph codeph">nodes</samp>—collect only from nodes specified in the <samp class="ph codeph">nodes</samp> parameter.</li>

 							</ul>

 						</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">yes</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 "><samp class="ph codeph">nodes</samp></td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">array</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">List of nodes to collect logs from.</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">yes, when the <samp class="ph codeph">from</samp> parameter is set to <samp class="ph codeph">nodes</samp>.</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 "><samp class="ph codeph">ticket</samp></td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">string</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">Couchbase support ticket number. The valid characters are digits 0 through 9. Maximum length is 7 characters. Invalid values are rejected.</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">no, but applicable only when the <samp class="ph codeph">upload</samp> parameter is set to <samp class="ph codeph">true</samp>.</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 "><samp class="ph codeph">upload</samp></td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">Boolean</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">Indicates whether to upload the collected logs to Couchbase support.</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">no</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 "><samp class="ph codeph">upload_host</samp></td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">string</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">Fully-qualified domain name, optionally prefixed with the <span class="ph filepath">https://</span> protocol specifier. If no protocol is specified, it defaults to <span class="ph filepath">https://</span>, which is the only valid protocol. If an invalid protocol is specified, the request returns an error.</td>

 						<td class="entry" valign="top" headers="d52784e135 d52784e138 d52784e141 d52784e144 ">yes, when the <samp class="ph codeph">upload</samp> parameter is set to <samp class="ph codeph">true</samp>.</td>

 					</tr>

 					
 				</tbody>

 			</table>
</div>

 	</div>

 	
 	<div class="section"><h2 class="title sectiontitle">Stopping log collection</h2>
 		
 		<p class="p">
 			You can stop log collection with the following HTTP request:
 		</p>

 		<pre class="pre codeblock">
POST /collectLogs/cancel
 		</pre>

 		
 	</div>

 	
 	<div class="section"><h2 class="title sectiontitle">Retrieving log collection status</h2>
 		
 		<p class="p">
 			You can retrieve the status of the log collection operation with the following HTTP request:
 		</p>

 		<pre class="pre codeblock">
GET /pools/default/tasks
 		</pre>

 		
 	<p class="p">The response to this request includes a JSON document that contains the following objects:</p>

 		
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all">
 				<thead class="thead" align="left">
 					<tr class="row">
 						<th class="entry" valign="top" id="d52784e333">Name</th>

 						<th class="entry" valign="top" id="d52784e336">Type</th>

 						<th class="entry" valign="top" id="d52784e339">Description</th>

 					</tr>

 				</thead>

 				<tbody class="tbody">
 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 "><samp class="ph codeph">per_node</samp></td>

 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 ">array</td>

 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 ">Status information for each node. Each entry in the array contains the following items:
 						<ul class="ul">
 							<li class="li"><samp class="ph codeph">artifact</samp>—name of the artifact</li>

 							<li class="li"><samp class="ph codeph">details</samp>—additional information about the status</li>

 							<li class="li"><samp class="ph codeph">node_name</samp>—name of the node</li>

 							<li class="li"><samp class="ph codeph">result</samp>—status of the collection operation on this node. Possible values are: <samp class="ph codeph">pending</samp>, <samp class="ph codeph">in_progress</samp>, <samp class="ph codeph">collected</samp>, <samp class="ph codeph">uploaded</samp>, <samp class="ph codeph">upload_failed</samp>, <samp class="ph codeph">failed</samp>, <samp class="ph codeph">cancelled</samp>.</li>
							
 						</ul>
</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 "><samp class="ph codeph">status</samp></td>

 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 ">string</td>

 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 ">Overall status of the log collection operation. The value can be <samp class="ph codeph">idle</samp> or <samp class="ph codeph">running</samp>.</td>

 					</tr>

 					<tr class="row">
 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 "><samp class="ph codeph">type</samp></td>

 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 ">string</td>

 						<td class="entry" valign="top" headers="d52784e333 d52784e336 d52784e339 ">The kind of information the document contains. The value is <samp class="ph codeph">collect_logs</samp></td>

 					</tr>

 				</tbody>

 			</table>
</div>

 		<p class="p">The structure of the result document looks similar to this:</p>

 		<pre class="pre codeblock">
{
    "type": "collect_logs"
    "status": "status", 
    "perNode": [
       {
            "artifact": "artifact_name", 
            "node_name": "node_name", 
            "result": "status",
            "details”: "optional additional details on failure reason etc."
        },
    ],
} 
 		</pre>

 		
 	</div>

 	
 </div>

<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Features/cluster-wide-info-intro.html" title="The Couchbase support team uses logs and other system diagnostics to analyze customer issues.">Cluster-wide diagnostics</a></div>
</div>
</div></main></div></div><footer><div class="navbar navbar-fixed-bottom"><div class="navbar-inner"><div class="container-fluid container"><div class="copyright">
								© 2014 COUCHBASE All rights reserved.
							</div></div></div></div></footer><script type="text/javascript" src="https://www.google.com/jsapi"></script><script>
					(function() {
					var cx = '018016427239405524608:fkg1v30apnm';
					var gcse = document.createElement('script');
					gcse.type = 'text/javascript';
					gcse.async = true;
					gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					'//www.google.com/cse/cse.js?cx=' + cx;
					var s = document.getElementsByTagName('script')[0];
					s.parentNode.insertBefore(gcse, s);
					})();
				</script></body></html>