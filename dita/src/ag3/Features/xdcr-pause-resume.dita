<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic id="topic_ix4_hkh_14">
  <title>Pause and resume replication</title>
  <shortdesc>During XDCR replication, the process can be paused and resumed. Performed via the
    Couchbase command-line interface (CLI).</shortdesc>
  
  <body>
    <p>XDCR streams between the source and destination cluster can be paused and later resumed. 
      After XDCR is resumed, data continues to replicate between the source and destination clusters
      starting from where it previously left off.
    </p>
    
       
    <section><title>CLI</title>
      <p>XDCR pause and resume is implemented with <codeph>couchbase-cli xdcr-replicate</codeph>.</p>
      <table frame="all" id="table_drj_bcn_c4">
        <title>xdcr-replicate options</title>
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="1*"/>
          <colspec colname="c2" colnum="2" colwidth="1.99*"/>
          <thead>
            <row>
              <entry>Option</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>--create</entry>
              <entry>Create and start a new replication</entry>
            </row>
            <row>
              <entry>--delete</entry>
              <entry>Stop and cancel a replication</entry>
            </row>
            <row>
              <entry>--list</entry>
              <entry>List all XDCR replications</entry>
            </row>
            <row>
              <entry>--pause</entry>
              <entry>Pause the replication</entry>
            </row>
            <row>
              <entry>--resume</entry>
              <entry>Resume the replication</entry>
            </row>
            <row>
              <entry>--settings</entry>
              <entry>Update settings for the replication</entry>
            </row>
            <row>
              <entry>--xdcr-replicator=REPLICATOR</entry>
              <entry>Replication ID</entry>
            </row>
            <row>
              <entry>--xdcr-from-bucket=BUCKET</entry>
              <entry>Local bucket name to replicate from</entry>
            </row>
            <row>
              <entry>--xdcr-cluster-name=CLUSTERNAME</entry>
              <entry>Remote cluster to replicate to</entry>
            </row>
            <row>
              <entry>--xdcr-to-bucket=BUCKETNAME</entry>
              <entry>Remote bucket to replicate to</entry>
            </row>
            <row>
              <entry>--max-concurrent - reps =[ 32 ]</entry>
              <entry>Maximum concurrent replications per bucket, 8 to 256</entry>
            </row>
            <row>
              <entry>--checkpoint-interval =[ 1800 ]</entry>
              <entry>Intervals between checkpoints , 60 to 14400 seconds</entry>
            </row>
            <row>
              <entry>--worker-batch-size =[ 500 ]</entry>
              <entry>Document batch size,  500 to 10000</entry>
            </row>
            <row>
              <entry>--doc-batch size =[ 2048 ] KB</entry>
              <entry>Document batch size, 10 to 100000 KB</entry>
            </row>
            <row>
              <entry>--failure-restart-interval =[ 30 ]</entry>
              <entry>Interval for restarting failed xdcr, 1 to 300 seconds</entry>
            </row>
            <row>
              <entry>--optimistic-replication-threshold =[ 256 ]</entry>
              <entry>Document body size threshold (bytes) to trigger optimistic replication</entry>
            </row>
            <row>
              <entry>--xdcr-replication-mode=[xmem|capi]</entry>
              <entry>Replication protocol, either capi or xmem</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
    </section>
      
      <section><title>CLI Syntax</title>
        <codeblock>
couchbase-cli xdcr-replicate -c HOST:PORT
    --pause	
    --xdcr-replicator=[REPLICATOR_ID]	
    -u ADMIN -p PASSWORD         
 
couchbase-cli xdcr-replicate -c HOST:PORT
  --resume	
  --xdcr-replicator=[REPLICATOR_ID]	
  -u ADMIN -p PASSWORD
        </codeblock>
        
      </section>
      

    <example><title>Pausing a running replication stream</title>
      <codeblock>
couchbase-cli xdcr-replicate -c 192.168.0.1:8091 \\	
    --pause \\	
    --xdcr-replicator=f4eb540d74c43fd3ac6d4b7910c8c92f/default/default \\	
    -u Administrator -p password
      </codeblock>
    </example>
      
    
    
      <example><title>Resuming a paused replication stream</title>
      <codeblock>
couchbase-cli xdcr-replicate -c 192.168.0.1:8091 \\	
    --resume \\	
    --xdcr-replicator=f4eb540d74c43fd3ac6d4b7910c8c92f/default/default \\	
    -u Administrator -p password
      </codeblock>
      </example>
      
      <example><title>Updating settings for a replication stream</title>
      <codeblock>
couchbase-cli xdcr-replicate -c 192.168.0.1:8091 \\	
    --settings \\	
    --xdcr-replicator=f4eb540d74c43fd3ac6d4b7910c8c92f/default/default \\	
    --max-concurrent-reps=32 \\	
    --checkpoint-interval=1800 \\	
    --worker-batch-size=500 \\	
    --doc-batch-size=2048 \\	
    --failure-restart-interval=30 \\	
    --optimistic-replication-threshold=256 \\	
    -u Administrator -p password        
      </codeblock>
      </example>
    
    <section><title>REST API</title>
      <p>The setting that pauses and resumes replication is the <codeph>pauseRequested</codeph> setting. 
        The setting values are true or false. Specify true to pause replication. Specify false to unpaused replication.</p>
      
      <table frame="all"
        id="table_xdcr_settings_uri">
        <title>XDCR URI paths for settings</title>
        <tgroup cols="2">
          <colspec colname="c1" colnum="1" colwidth="1*"/>
          <colspec colname="c2" colnum="2" colwidth="1.35*"/>
          <thead>
            <row>
              <entry>URI path</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>/settings/replications/</entry>
              <entry>Global setting supplied to all replications for a cluster.</entry>
            </row>
            <row>
              <entry>/settings/replications/[replication_id]</entry>
              <entry>Settings for specific replication for a bucket.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
      <table frame="all"
        id="table_xdcr_internal_settings">
        <title>XDCR internal settings</title>
        <tgroup cols="3">
          <colspec colname="col1" colwidth="1*"/>
          <colspec colname="col2" colwidth="1.08*"/>
          <colspec colname="col3" colwidth="1.68*"/>
          <thead>
            <row>
              <entry>Parameter</entry>
              <entry>Value</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><codeph>pauseRequested</codeph></entry>
              <entry>True or False. Default: False</entry>
              <entry>Specify true to pause the replication. Specify false to un-pause the replication.</entry>
            </row>
          </tbody>
        </tgroup>
      </table>
      
    </section>
    
    <example><title>Retrieve replication settings example</title>
    <p>The following example retrieves the current settings for a replication.</p>
      <codeblock>
# curl -X GET -u Administrator:password http://10.5.2.54:8091/settings/replications  

{
    "maxConcurrentReps":16,
    "checkpointInterval":1800,
    "docBatchSizeKb":2048,
    "failureRestartInterval":30,
    "workerBatchSize":500,
    "connectionTimeout":180,
    "workerProcesses":4,
    "httpConnections":20,
    "retriesPerRequest":2,
    "optimisticReplicationThreshold":256,
    "socketOptions":{"keepalive":true,"nodelay":false},
    "pauseRequested":false,
    "supervisorMaxR":25,
    "supervisorMaxT":5
}
      </codeblock>
    </example>
    
    <example><title>Pause replication example</title>
    
    <codeblock>
# curl -X POST -u Administrator:password http://10.5.2.54:8091/settings/replications -d pauseRequested=true    
    </codeblock>
    </example>
    
  </body>
</topic>
