<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic xml:lang="en-us" id="topic34000">
 <title>Rebalancing</title>
 <body>
  <p>As you store data into your Couchbase Server cluster, you may need to alter the number of nodes
   in your cluster to cope with changes in your application load, RAM, disk I/O and networking
   performance requirements.</p>
  <p>Couchbase Server is designed to actively change the number of nodes configured within the
   cluster to cope with these requirements, all while the cluster is up and running and servicing
   application requests. The overall process is broken down into two stages; the addition and/or
   removal of nodes in the cluster, and the <codeph>rebalancing</codeph> of the information across
   the nodes.</p>
  <p>The addition and removal process merely configures a new node into the cluster, or marks a node
   for removal from the cluster. No actual changes are made to the cluster or data when configuring
   new nodes or removing existing ones.</p>
  <p>During the rebalance operation:</p>
  <ul>
   <li><p>Using the new Couchbase Server cluster structure, data is moved between the vBuckets on
     each node from the old structure. This process works by exchanging the data held in vBuckets on
     each node across the cluster. This has two effects:</p>
    <ul>
     <li><p>Removes the data from machines being removed from the cluster. By totally removing the
       storage of data on these machines, it allows for each removed node to be taken out of the
       cluster without affecting the cluster operation.</p></li>
     <li><p>Adds data and enables new nodes so that they can serve information to clients. By moving
       active data to the new nodes, they will be made responsible for the moved vBuckets and for
       servicing client requests.</p></li>
    </ul></li>
   <li><p>Rebalancing moves both the data stored in RAM, and the data stored on disk for each
     bucket, and for each node, within the cluster. The time taken for the move is dependent on the
     level of activity on the cluster and the amount of stored information.</p></li>
   <li><p>The cluster remains up, and continues to service and handle client requests. Updates and
     changes to the stored data during the migration process are tracked and will be updated and
     migrated with the data that existed when the rebalance was requested.</p></li>
   <li><p>The current vBucket map, used to identify which nodes in the cluster are responsible for
     handling client requests, is updated incrementally as each vBucket is moved. The updated
     vBucket map is communicated to Couchbase client libraries and enabled smart clients (such as
     Moxi), and allows clients to use the updated structure as the rebalance completes. This ensures
     that the new structure is used as soon as possible to help spread and even out the load during
     the rebalance operation.</p></li>
  </ul>
  <p>Because the cluster stays up and active throughout the entire process, clients can continue to
   store and retrieve information and do not need to be aware that a rebalance operation is taking
   place.</p>
  <p>There are four primary reasons that you perform a rebalance operation:</p>
  <ul>
   <li><p>Adding nodes to expand the size of the cluster.</p></li>
   <li><p>Removing nodes to reduce the size of the cluster.</p></li>
   <li><p>Reacting to a failover situation, where you need to bring the cluster back to a healthy
     state.</p></li>
   <li><p>You need to temporarily remove one or more nodes to perform a software, operating system
     or hardware upgrade.</p></li>
  </ul>
  <p>Regardless of the reason for the rebalance, the purpose of the rebalance is migrate the cluster
   to a healthy state, where the configured nodes, buckets, and replicas match the current state of
   the cluster.</p>
  

   
   
  

 
 </body>
 <related-links>
  <linklist>
    <link href="../Monitoring/monitor-rebalance.dita"></link>
    <link href="../REST/rest-cluster-rebalance.dita"></link>
    <link href="../REST/rest-server-nodes.dita"></link>
  </linklist>
 </related-links>
</topic>
