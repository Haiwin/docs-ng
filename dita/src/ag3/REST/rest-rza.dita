<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic xml:lang="en-us" id="topic7058">
  <title>Rack Awareness REST API</title>

    <shortdesc>The Rack Awareness feature allows logical groupings of servers on a cluster where
    each server group physically belongs to a rack or availability zone. </shortdesc>
  
  <body>
    <p>This feature provides the ability to specify that active and corresponding replica partitions
      be created on servers that are part of a separate rack or zone. For purposes of the server
      group REST API, racks or availability zones are represented as flat space of server groups
      with group names. To enable Rack Awareness, all servers in a cluster must be upgraded to use
      the Rack Awareness feature. </p>
    
    <note type="note">The Rack Awareness feature with its server group capability is an Enterprise Edition
      feature.</note>
    <p>The Server groups REST API provides the following capability:</p>
    <ul>
      <li>Creates server groups</li>
      <li>Edits server groups</li>
      <li>Deletes server groups</li>
      <li>Assigns servers to server groups.</li>
    </ul>
    <section><title>HTTP Methods</title><p>The following summarizes the HTTP methods used for
        managing server groups.</p><table>
        <tgroup cols="3">
          <colspec colname="col1"/>
          <colspec colname="col2"/>
          <colspec colname="col3"/>
          <thead>
            <row>
              <entry>HTTP method</entry>
              <entry>URI path</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>GET</entry>
              <entry>/pools/default/serverGroups</entry>
              <entry>Retrieves information about a server group.</entry>
            </row>
            <row>
              <entry>POST</entry>
              <entry>/pools/default/serverGroups</entry>
              <entry>Creates a server group with a specific name.</entry>
            </row>
            <row>
              <entry>PUT</entry>
              <entry>/pools/default/serverGroups/&lt;:uuid&gt;</entry>
              <entry>Updates the server group information.</entry>
            </row>
            <row>
              <entry>PUT</entry>
              <entry>/pools/default/serverGroups?rev=&lt;:number&gt;</entry>
              <entry>Updates a server’s group memberships.</entry>
            </row>
            <row>
              <entry>DELETE</entry>
              <entry>/pools/default/serverGroups/&lt;:uuid&gt;</entry>
              <entry>Deletes a specific server group.</entry>
            </row>
          </tbody>
        </tgroup>
      </table></section>
    <section><title>Retrieving server group information</title><p><codeph>GET
          /pools/default/serverGroups</codeph> retrieves information about server groups. Provides
        group information, <codeph>"groups": [(&lt;groupInfo&gt;)+]</codeph>, where each server
        group has unique URIs and
          UUIDs.</p><p><b>Syntax</b></p><codeblock><codeph>curl -X GET -u &lt;administrator&gt;:&lt;password&gt; 
   http://&lt;host&gt;:&lt;port&gt;/pools/default/serverGroups
</codeph></codeblock><p><b>Example</b></p><codeblock><codeph>curl -X GET -u Admin:myPassword 
   http://192.168.0.1:8091/pools/default/serverGroups
</codeph></codeblock><p><b>Returns</b></p><codeblock><codeph>{"groups":
   [
      {
      "name":"&lt;groupName&gt;", 
      "uri": "/pools/default/serverGroups?rev=&lt;integer&gt;",
      "addNodeURI":"/pools/default/serverGroups/0",
      "nodes":[(&lt;nodeInfo&gt;)+]
      }
    ]
}
</codeph></codeblock><table>
        <tgroup cols="2">
          <colspec colname="col1"/>
          <colspec colname="col2"/>
          <thead>
            <row>
              <entry>Group info</entry>
              <entry>Description</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry><codeph>"groups": [(&lt;groupInfo&gt;)+]</codeph></entry>
              <entry>Information about server groups.</entry>
            </row>
            <row>
              <entry><codeph>"name":"&lt;groupName&gt;"</codeph></entry>
              <entry>Specifies the name of the group. If the group name has a space, for example,
                Group A, use double quotes (for example, <codeph>"Group A"</codeph>). If the name
                does not have spaces (for example, GroupA) double quotes are not required.</entry>
            </row>
            <row>
              <entry><codeph>"uri":"/pools/default/serverGroups?rev=&lt;integer&gt;"</codeph></entry>
              <entry>Specifies the URI path and revision integer.</entry>
            </row>
            <row>
              <entry><codeph>"uri":"/pools/default/serverGroups/&lt;:uuid&gt;"</codeph></entry>
              <entry>Specifies the URI path and UUID string.</entry>
            </row>
            <row>
              <entry><codeph>"addNodeURI":"/pools/default/serverGroups/&lt;:uuid&gt;/addNode</codeph></entry>
              <entry>Specifies the URI path and UUID string for adding servers to a server
                group.</entry>
            </row>
            <row>
              <entry><codeph>"nodes": [(&lt;nodeInfo&gt;+)]</codeph></entry>
              <entry>Information about the servers.</entry>
            </row>
          </tbody>
        </tgroup>
      </table></section>
    <section><title>Creating server groups</title><p><codeph>POST
          /pools/default/serverGroups</codeph> creates a server group with a specific name. In the
        following example, Group A is created. If the group name has a space, for example, Group A,
        use double quotes; for example, <codeph>"Group
          A"</codeph>.</p><p><b>Syntax</b></p><codeblock><codeph>curl -X POST -u &lt;administrator&gt;:&lt;password&gt; 
  http://&lt;host&gt;:&lt;port&gt;/pools/default/serverGroups 
  -d name="&lt;groupName&gt;"
</codeph></codeblock><p><b>Example</b></p><codeblock><codeph>curl -X POST -u Admin:myPassword 
  http://192.168.0.1:8091/pools/default/serverGroups 
  -d name="Group A"
</codeph></codeblock></section>
    <section><title>Renaming server groups</title><p><codeph>PUT
          /pools/default/serverGroups/&lt;:uuid&gt;</codeph> renames the server group. Find the UUID
        for the server group by using GET, add the UUID to the URI path, and specify a new group
        name. In this example, Group A is renamed to Group B. The UUID for the server group is
        located in the full URI information for that server group. The UUID remains the same for the
        server group after changing the name.</p><p>For example, the UUID for Group A is located in
        the following group
          information:</p><codeblock><codeph>"name":"Group A",
"uri":"/pools/default/serverGroups/246b5de857e100dbfd8b6dee0406420a"
</codeph></codeblock><p><b>Syntax</b></p><codeblock><codeph>curl -X PUT -u &lt;administrator&gt;:&lt;password&gt; 
  http://&lt;host&gt;:&lt;port&gt;/pools/default/serverGroups/&lt;uuid&gt; 
  -d name="&lt;newGroupName&gt;"
</codeph></codeblock><p><b>Example</b></p><codeblock><codeph>curl -X PUT -u Admin:myPassword 
  http://192.168.0.1:8091/pools/default/serverGroups/246b5de857e100dbfd8b6dee0406420a 
  -d name="Group B"
</codeph></codeblock></section>
    <section><title>Deleting server groups</title><p><codeph>DELETE
          /pools/default/serverGroups/&lt;:uuid&gt;</codeph> deletes a specific server group. The
        server group must be empty for a successful request. In the following example, the UUID is
        the same UUID used in the renaming
          example.</p><p><b>Syntax</b></p><codeblock><codeph>curl -X DELETE -u &lt;administrator&gt;:&lt;password&gt; 
  http://&lt;host&gt;:&lt;port&gt;/pools/default/serverGroups/&lt;uuid&gt;
</codeph></codeblock><p><b>Example</b></p><codeblock><codeph>curl -X DELETE -u Admin:myPassword 
  http://192.168.0.1:8091/pools/default/serverGroups/246b5de857e100dbfd8b6dee0406420a
</codeph></codeblock></section>
    <section><title>Adding servers to server groups</title><p><codeph>POST
          /pools/default/serverGroups/&lt;:uuid&gt;/addNode</codeph> adds a server to a cluster and
        assigns it to the specified server group.
          </p><p><b>Syntax</b></p><codeblock><codeph>curl -X POST -dhostname=&lt;host&gt;:&lt;port&gt; 
  -u &lt;administrator&gt;:&lt;password&gt; 
  http://&lt;host&gt;:&lt;port&gt;/pools/default/serverGroups/&lt;uuid&gt;/addNode
</codeph></codeblock><p><b>Example</b></p><codeblock><codeph>curl -X POST -dhostname=192.168.0.2:8091 
  -u Admin:myPassword 
  http://192.168.0.1:8091/pools/default/serverGroups/246b5de857e100dbfd8b6dee0406420a/addNode
</codeph></codeblock><p>The
        server group’s UUID is in the group
      information</p><codeblock><codeph>"name":"Group 2",
"uri":"/pools/default/serverGroups/d55339548767ceb51b241c61e3b9f036",
"addNodeURI":"/pools/default/serverGroups/d55339548767ceb51b241c61e3b9f036/addNode",
</codeph></codeblock></section>
    <section><title>Updating server group memberships</title><p><codeph>PUT
          /pools/default/serverGroups?rev=&lt;:number&gt;</codeph> updates the server’s group
        memberships. In the following examples, the group name is optional. If the group name is
        provided, it <i>must</i> match the current group name. All servers must be mentioned and
          <i>all</i> groups must be mentioned. The URI is used to identify the group.</p><p>This
        request only allows moving servers between server groups. It does not allow server group
        renaming or removal. In this example, the servers for Group 2 are moved to Group 1.
        </p><p>The following is the group information that is needed to update the server and server
        group
          memberships:</p><codeblock><codeph>{
   "groups": [( { ("name": &lt;groupName:string&gt;,)? 
   "uri": "/pools/default/serverGroups/"&lt;uuid&gt;,
   "nodes": [(&lt;otpNode&gt;)*]
}
</codeph></codeblock><p><b>Syntax</b></p><codeblock><codeph>curl -d @&lt;inputFile&gt; -X PUT 
  -u &lt;administrator&gt;:&lt;password&gt; 
  http://&lt;host&gt;:&lt;port&gt;/pools/default/serverGroups?rev=&lt;number&gt;
</codeph></codeblock><p><b>Example</b></p><p>In
        this example, a JSON file is
          used.</p><codeblock><codeph>curl -d@file.json -X PUT 
  http://Administrator:asdasd@192.168.0.1:8091/pools/default/serverGroups?rev=120137811
</codeph></codeblock><p><b>Example</b></p><p>In
        this example, the JSON data is provided on the command
        line.</p>
      
      <codeblock>
curl -v -X PUT 
  -u Administrator:password 
  http://192.168.171.144:8091/pools/default/serverGroups?rev=28418649 
  -d '{"groups":
      [{"nodes": [{"otpNode": "ns_1@192.168.171.144"},
                  {"otpNode": "ns_1@192.168.171.145"}], 
        "name": "Group 1", 
        "uri": "/pools/default/serverGroups/0"}, 
       {"nodes": [], 
        "name": "Group 2", 
        "uri": "/pools/default/serverGroups/3ca074a8456e1d4940cfa3b7badc1e22"}] }'
</codeblock>
      
      <note type="note">The
        PUT request is transactional. The request either succeeds completely or fails without
        impact. If all nodes or groups are not passed, a generic error message: "Bad input" occurs
        and the server group is removed. </note></section>
    
  </body>
  
</topic>
